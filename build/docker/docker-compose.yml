version: '3.3'

services:
  # ---------------------------
  # Service Discovery
  # ---------------------------
  service-discovery:
    container_name: "service-discovery"
    hostname: "service-discovery"
    build: ../../service-registration-server/target
    ports:
      - "8761:8761"
    expose:
      - "8761"
    networks:
      - backend
  # ---------------------------
  # API Gateway
  # ---------------------------
  api-gateway:
    container_name: "api-gateway"
    hostname: "api-gateway"
    build: ../../api-gateway/target
    ports:
      - "8762:8762"
    expose:
      - "8762"
    depends_on:
      - service-discovery
    networks:
      - backend

  # ---------------------------
  # Status Checker Service
  # ---------------------------
  status-checker:
    container_name: "status-checker"
    hostname: "status-checker"
    build: ../../user-vecihle-status-service/target
    ports:
      - "8080:8080"
    expose:
      - "8080"
    depends_on:
      - service-discovery
    networks:
      - backend

  # ---------------------------
  # Status Simulator Service
  # ---------------------------
  status-simulator:
    container_name: "status-simulator"
    hostname: "status-simulator"
    build: ../../status-simulator/target
    ports:
      - "8081:8081"
    expose:
      - "8081"
    depends_on:
      - service-discovery
    networks:
      - backend

  # ---------------------------
  # Web Application
  # ---------------------------
  status-checker-webapp:
    container_name: "status-checker-webapp"
    build:
      context: ../../status-checker/
    volumes:
      - ../../status-checker/:/app
      - /app/node_modules
    ports:
      - "5000:80"
    expose:
      - "5000"
    depends_on:
      - status-checker
      - status-simulator
    networks:
      - frontend

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge
  
